!function(){"use strict";const e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-btn",inactiveButtonClass:"popup__submit-btn_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},t={},s=document.getElementById("edit-form"),n=document.querySelector(".profile__edit-btn"),r=document.querySelector(".profile__add-btn"),i=document.querySelector(".avatar__editBtn"),a=document.querySelector(".popup__photo"),o=document.querySelector(".popup__photoTitle"),l=new class{constructor(e){this._baseURL=e.baseURL,this._headers=e.headers}_checkServerResponse(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status," - ").concat(e.statusText))}getInitialCards(){return fetch("".concat(this._baseURL,"/cards"),{method:"GET",headers:this._headers}).then((e=>this._checkServerResponse(e)))}getUserInfo(){return fetch("".concat(this._baseURL,"/users/me"),{method:"GET",headers:this._headers}).then((e=>this._checkServerResponse(e)))}updateUserInfo(e){return fetch("".concat(this._baseURL,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.description})}).then((e=>this._checkServerResponse(e)))}updateUserAvatar(e){return fetch("".concat(this._baseURL,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e.link})}).then((e=>this._checkServerResponse(e)))}addCardData(e){return fetch("".concat(this._baseURL,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e.title,link:e.link})}).then((e=>this._checkServerResponse(e)))}likeCard(e,t){const s=t?"DELETE":"PUT";return fetch("".concat(this._baseURL,"/cards/likes/").concat(e),{method:s,headers:this._headers}).then((e=>this._checkServerResponse(e)))}deleteCardData(e){return fetch("".concat(this._baseURL,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((e=>this._checkServerResponse(e)))}processInitialRequests(e){return Promise.all(e).then((e=>e))}}({baseURL:"https://around.nomoreparties.co/v1/cohort-3-en",headers:{authorization:"e9954642-7ca9-42fe-b8e5-fe91e4314998","Content-Type":"application/json"}});class c{constructor(e,t){this._settings=e,this._formElement=t}_showInputError(e,t){const s=this._formElement.querySelector(".".concat(e.id,"-error"));e.classList.add(this._settings.inputErrorClass),s.textContent=t,s.classList.add(this._settings.errorClass)}_hideInputError(e){const t=this._formElement.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._settings.inputErrorClass),t.textContent="",t.classList.remove(this._settings.errorClass)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hasInvalidInput(e){return e.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput(this._inputList)?(this._buttonElement.disabled=!0,this._buttonElement.classList.add(this._settings.inactiveButtonClass)):(this._buttonElement.disabled=!1,this._buttonElement.classList.remove(this._settings.inactiveButtonClass))}_setInputEventListeners(){this._inputList=Array.from(this._formElement.querySelectorAll(this._settings.inputSelector)),this._buttonElement=this._formElement.querySelector(this._settings.submitButtonSelector),this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setInputEventListeners()}resetValidation(){this._toggleButtonState(),this._inputList.forEach((e=>{this._hideInputError(e)}))}}class h{constructor(e,t){let{cardData:s,userId:n,handleCardClick:r,handleLikeCard:i,handleDeleteCard:a}=e;this._title=s.name,this._link=s.link,this._cardId=s._id,this._likes=s.likes,this._owner=s.owner,this._userId=n,this._cardSelector=t,this._handleCardClick=r,this._handleLikeCard=i,this._handleDeleteCard=a}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}generateCard(){this._element=this._getTemplate(),this._cardPhoto=this._element.querySelector(".card__photo-container");const e=this._element.querySelector(".card__title");return this._deleteBtn=this._element.querySelector(".card__delete-btn"),this._cardPhoto.style.backgroundImage="url(".concat(this._link,")"),this._cardPhoto.ariaLabel=this._title,e.textContent=this._title,this.isOwner()||this._deleteBtn.remove(),this.setCardLikes(this._likes),this._setEventListeners(),this._element}deleteCard(){this._element.remove(),this._element=null,this._cardTitle=null,this._cardPhoto=null,this._likeBtn=null,this._cardLikesElement=null}setCardLikes(e){this._likes=e,this._isLiked=this.isLiked(),this._likeBtn=this._element.querySelector(".card__like-btn"),this._cardLikesElement=this._element.querySelector(".card__like-count"),this._isLiked?this._likeBtn.classList.add("card__like-btn_active"):this._likeBtn.classList.remove("card__like-btn_active"),this._cardLikesElement.textContent=this._likes.length}isLiked(){return!!this._likes.find((e=>e._id===this._userId))}isOwner(){return this._userId===this._owner._id}getId(){return this._cardId}_setEventListeners(){this._deleteBtn.addEventListener("click",(e=>{e.stopPropagation(),this._handleDeleteCard()})),this._likeBtn.addEventListener("click",this._handleLikeCard),this._cardPhoto.addEventListener("click",(()=>{this._handleCardClick({title:this._title,link:this._link})}))}}class d{constructor(e){var t,s;s=e=>{"Escape"===e.key&&this.close()},(t="_handleEscClose")in this?Object.defineProperty(this,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[t]=s,this._popup=document.querySelector(e)}open(){this._popup.classList.add("popup__active"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup__active"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._popup.addEventListener("mousedown",(e=>{e.target.classList.contains("popup__active")&&this.close(),e.target.classList.contains("popup__close-btn")&&this.close()}))}}class _ extends d{constructor(e,t){super(t),this._link=e.link,this._title=e.title}open(){a.src=this._link,a.alt=this._title,o.textContent=this._title,super.open()}}class u extends d{constructor(t,s){var n,r;super(t),r=()=>{this._handleFormSubmit(this._getInputValues())},(n="_formSubmit")in this?Object.defineProperty(this,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[n]=r,this._handleFormSubmit=s,this._formElement=this._popup.querySelector(e.formSelector)}_getInputValues(){const t=Array.from(this._popup.querySelectorAll(e.inputSelector)),s={};return t.forEach((e=>{s[e.name]=e.value})),s}setEventListeners(){super.setEventListeners()}changeButtonText(e){this._formElement.querySelector(".popup__submit-btn").textContent=e}changeSubmitHandler(e){this._handleFormSubmit=e}open(){super.open(),this._formElement.reset(),this._formElement.addEventListener("submit",this._formSubmit)}close(){this._formElement.removeEventListener("submit",this._formSubmit),super.close()}}let p;l.processInitialRequests([l.getUserInfo(),l.getInitialCards()]).then((e=>{let[t,s]=e;E.setUserInfo({name:t.name,about:t.about}),E.setAvatar(t.avatar),p=t._id,s.reverse().forEach((e=>{m(e)}))})).catch((e=>{console.log(e)}));const m=e=>{const t=new h({cardData:e,userId:p,handleCardClick:e=>{const t=new _(e,"#photo-viewer-popup");t.open(),t.setEventListeners()},handleLikeCard:()=>{l.likeCard(t.getId(),t.isLiked()).then((e=>{t.setCardLikes(e.likes)})).catch((e=>console.log(e)))},handleDeleteCard:()=>{f.open(),f.changeSubmitHandler((()=>{f.changeButtonText("Deleting..."),l.deleteCardData(t.getId()).then((()=>{t.deleteCard()})).catch((e=>console.log(e))).finally((()=>{f.close(),f.changeButtonText("Yes")}))}))}},"#card-template");v.addItem(t.generateCard())},v=new class{constructor(e,t){let{items:s,renderer:n}=e;this._initialArray=s,this._renderer=n,this._container=document.querySelector(t)}addItem(e){this._container.prepend(e)}clear(){this._container.innerHTML=""}renderItems(){this.clear(),this._initialArray.forEach((e=>{this._renderer(e)}))}}({items:null,renderer:m},".gallery__list"),E=new class{constructor(e){let{selectors:t}=e;this._nameElement=document.querySelector(t.name),this._descriptionElement=document.querySelector(t.description),this._avatarElement=document.querySelector(t.avatar)}getUserInfo(){const e={};return e.name=this._nameElement.textContent,e.about=this._descriptionElement.textContent,e.avatar=this._avatarElement.style.backgroundImage,e}setUserInfo(e){this._nameElement.textContent=e.name,this._descriptionElement.textContent=e.about}setAvatar(e){this._avatarElement.style.backgroundImage="url(".concat(e,")")}}({selectors:{name:".profile__name-title",description:".profile__description",avatar:".avatar"}}),g=new u("#add-popup",(e=>{g.changeButtonText("Saving..."),l.addCardData(e).then((e=>{m(e),g.close()})).catch((e=>{console.log(e)})).finally((()=>{g.changeButtonText("Create")}))})),k=new u("#edit-popup",(e=>{k.changeButtonText("Saving..."),l.updateUserInfo(e).then((e=>{E.setUserInfo(e),k.close()})).catch((e=>{console.log(e)})).finally((()=>{k.changeButtonText("Save")}))})),b=new u("#edit-avatar-popup",(e=>{b.changeButtonText("Saving..."),l.updateUserAvatar(e).then((e=>{E.setAvatar(e.avatar),b.close()})).catch((e=>console.log(e))).finally((()=>{b.changeButtonText("Save")}))})),f=new u("#delete-card-popup");var L;n.addEventListener("click",(function(){const{name:e,about:n}=E.getUserInfo();k.open(),s.name.value=e,s.description.value=n,t["edit-form"].resetValidation()})),r.addEventListener("click",(function(){g.open(),t["add-form"].resetValidation()})),i.addEventListener("click",(function(){b.open(),t["edit-avatar-form"].resetValidation()})),L=e,Array.from(document.querySelectorAll(L.formSelector)).forEach((e=>{const s=new c(L,e);t[e.getAttribute("name")]=s,s.enableValidation()})),g.setEventListeners(),k.setEventListeners(),b.setEventListeners(),f.setEventListeners()}();